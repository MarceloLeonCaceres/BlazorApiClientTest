@page "/counter"
@using System.Net.Http.Json
@using System.Net.Http.Headers
@inject IHttpClientFactory factory
@inject TokenModel tokenInfo

<PageTitle>Student</PageTitle>

<h1>Student</h1>

@if(string.IsNullOrWhiteSpace(errorMessage) == false)
{
    <div>@errorMessage</div>
}
<button class="btn btn-primary" @onclick="ShowStudents">Get Student's list'</button>

@if(students is not null)
{
    @foreach(var s in students)
    {
        <div class="row">
            <div class="col-md-3">@s.Name</div>
            <div class="col-md-3">@s.LastName</div>
            <div class="col-md-3">@s.CreationDate</div>
            <div class="col-md-3">@s.Active</div>
        </div>
    }
}


@code {

    private List<StudentModel>? students;
    private HttpClient? client;
    string? errorMessage;

    private async void ShowStudents()
    {
        errorMessage = "";
        client = factory.CreateClient("api");
        client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", tokenInfo.Token);

        try
        {
            students = await client.GetFromJsonAsync<List<StudentModel>>("Students");
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
        }
        await InvokeAsync(StateHasChanged);
    }

}
